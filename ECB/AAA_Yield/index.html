<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tau 1 - AAA-rated Government Bonds Yield Curve</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const base_url = "https://data-api.ecb.europa.eu/service/data/FM/M.U2.EUR.RT.MM";
    const queryParams = {
        Frequency: 'B',
        ReferenceArea: 'U2',
        Currency: 'EUR',
        FinancialMarketProvider: '4F',
        FinancialMarketInstrument: 'G_N_A',
        FinancialMarketProviderIdentifier: 'SV_C_YM',
        FinancialMarketDataType: 'TAU1'
    };

    function constructQueryUrl() {
        let queryParts = [];
        for (const [key, value] of Object.entries(queryParams)) {
            queryParts.push(`${key}=${encodeURIComponent(value)}`);
        }
        return `${base_url}?${queryParts.join('&')}`;
    }

    function fetchDataAndPlot() {
        let full_url = constructQueryUrl();
        
        $.getJSON(full_url, function(data) {
            // Placeholder: Adjust based on the actual structure of the response from the ECB API
            let observations = data.observations;
            let dates = observations.map(obs => obs.date); // Adjust 'date' as per response
            let values = observations.map(obs => obs.value); // Adjust 'value'

            let bond_yield_data = [{
                dates: dates.map(date => new Date(date)),
                values: values,
                type: 'Euro Area AAA-rated Tau 1'
            }];

            plotData(bond_yield_data);
        });
    }

    function plotData(bond_yield_data) {
        let traces = bond_yield_data.map(dataItem => {
            return {
                x: dataItem.dates,
                y: dataItem.values,
                type: 'scatter',
                mode: 'lines+markers',
                name: dataItem.type,
                line: { shape: 'spline', smoothing: 1.3 }
            };
        });

        let layout = {
            title: 'Euro Area AAA-rated Government Bonds Yield Curve - Tau 1',
            xaxis: {
                title: 'Date',
                tickformat: "%b %d, %Y",
                type: 'date'
            },
            yaxis: {
                title: 'Tau 1 Value',
                fixedrange: true
            },
            margin: { l: 50, r: 25, b: 50, t: 50, pad: 4 },
            plot_bgcolor: 'white',
            responsive: true
        };

        Plotly.newPlot('plot', traces, layout);
    }

    fetchDataAndPlot();
});
</script>
<style>
body { font-family: Arial, sans-serif; }
#plot { width: 100%; height: 90vh; }
</style>
</head>
<body>
<h1>Euro Area AAA-rated Government Bonds Yield Curve - Tau 1</h1>
<div id="plot"></div>
</body>
</html>
